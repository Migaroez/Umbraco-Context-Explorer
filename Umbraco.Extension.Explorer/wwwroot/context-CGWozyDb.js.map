{"version":3,"file":"context-CGWozyDb.js","sources":["../../umbraco.context.explorer.client/src/Core/context.ts"],"sourcesContent":["import {UmbContextBase} from \"@umbraco-cms/backoffice/class-api\";\r\nimport {\r\n    UmbContextConsumerController, UmbContextDebugRequest, UmbContextToken,\r\n    UmbDebugContextData, UmbDebugContextItemData, contextData\r\n} from \"@umbraco-cms/backoffice/context-api\";\r\nimport {UmbControllerHost, UmbControllerHostElement} from \"@umbraco-cms/backoffice/controller-api\";\r\nimport {filter} from \"@umbraco-cms/backoffice/external/rxjs\";\r\nimport {UmbObjectState} from \"@umbraco-cms/backoffice/observable-api\";\r\nimport {\r\n    UMB_MODAL_MANAGER_CONTEXT,\r\n    UmbModalManagerContext\r\n} from \"@umbraco-cms/backoffice/modal\";\r\nimport {html, map} from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UMB_CONTEXT_DEBUGGER_MODAL } from \"@umbraco-cms/backoffice/debug\";\r\nimport { umbExtensionsRegistry } from \"@umbraco-cms/backoffice/extension-registry\";\r\n\r\nexport const UMB_EXTENSION_EXPLORER_CONTEXT = new UmbContextToken<UmbExtensionExplorerContext>('UmbExtensionExplorerContext');\r\n\r\nexport class UmbExtensionExplorerContext extends UmbContextBase<UmbExtensionExplorerContext> {\r\n    #state = new UmbObjectState<UmbExtensionExplorerStateModel | undefined>(undefined)\r\n    readonly state = this.#state.asObservable().pipe(filter((state) => !!state));\r\n    readonly hide = this.#state.asObservablePart((state) => state?.hide);\r\n\r\n    constructor(host: UmbControllerHost) {\r\n        super(host, UMB_EXTENSION_EXPLORER_CONTEXT);\r\n        this.#state?.setValue({hide: true})\r\n    }\r\n\r\n    public toggle() {\r\n        this.#state?.setValue({hide: !this.#state?.value?.hide})\r\n    }\r\n\r\n    getHostContexts(host: UmbControllerHostElement, callback: { (data: UmbDebugContextData[]): void }) {\r\n        host.dispatchEvent(\r\n            new UmbContextDebugRequest((contexts: Map<any, any>) => {\r\n                // The Contexts are collected\r\n                // When travelling up through the DOM from this element\r\n                // to the root of <umb-app> which then uses the callback prop\r\n                // of this event that has been raised to assign the contexts\r\n                // back to this property of the WebComponent\r\n\r\n                // Massage the data into a simplier array of objects\r\n                // from a function in the context-api.\r\n                callback(contextData(contexts));\r\n            }),\r\n        );\r\n    }\r\n\r\n    public displayHostContexts(host: UmbControllerHostElement, registrationAlias: string) {\r\n        this.getHostContexts(host, (contexts) => {\r\n            new UmbContextConsumerController(host, UMB_MODAL_MANAGER_CONTEXT, (instance: UmbModalManagerContext) => {\r\n                instance?.open(host, UMB_CONTEXT_DEBUGGER_MODAL, {\r\n                    data: {\r\n                        content: this.generateDialogContent(contexts,registrationAlias)\r\n                    }\r\n                })\r\n            });\r\n        });\r\n    }\r\n\r\n    public generateDialogContent(contexts: Array<UmbDebugContextData>, registrationAlias:string){\r\n        return html`\r\n        <div class=\"events\">\r\n\t\t\t${this.#renderContexts(contexts)}\r\n            ${this.#renderRegistration(registrationAlias)}\r\n\t\t</div>`;\r\n    }\r\n\r\n    #renderContexts(contexts: Array<UmbDebugContextData>) {\r\n\t\treturn html`<div class=\"events\">\r\n            <h3>Available Contexts</h3>\r\n\t\t\t${map(contexts, (context) => {\r\n\t\t\t\treturn html`\r\n\t\t\t\t\t<details>\r\n\t\t\t\t\t\t<summary><strong>${context.alias}</strong></summary>\r\n\t\t\t\t\t\t${this.#renderContextData(context.data)}\r\n\t\t\t\t\t</details>\r\n\t\t\t\t`;\r\n\t\t\t})}\r\n\t\t</div>`;\r\n\t}\r\n\r\n    #renderRegistration(registrationAlias: string) {\r\n        const registration = umbExtensionsRegistry.getByAlias(registrationAlias);\r\n        if(!registration) {return;}\r\n\r\n\t\treturn html`<div class=\"events\">\r\n            <h3>Registration</h3>\r\n\t\t\t<details>\r\n                <summary><strong>${registrationAlias}</strong></summary>\r\n                <pre>${JSON.stringify(registration, undefined, 2)}</pre>\r\n            </details>\r\n\t\t</div>`;\r\n\t}\r\n\r\n    #renderContextData(instance: UmbDebugContextItemData) {\r\n\t\tswitch (instance.type) {\r\n\t\t\tcase 'function': {\r\n\t\t\t\treturn html`<h3>Callable Function</h3>`;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'object': {\r\n\t\t\t\treturn html`\r\n\t\t\t\t\t<details>\r\n\t\t\t\t\t\t<summary>Methods</summary>\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t${map(instance.methods, (methodName) => html`<li>${methodName}</li>`)}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</details>\r\n\r\n\t\t\t\t\t<details>\r\n\t\t\t\t\t\t<summary>Properties</summary>\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t${map(instance.properties, (property) => {\r\n\t\t\t\t\t\t\t\tswitch (property.type) {\r\n\t\t\t\t\t\t\t\t\tcase 'string':\r\n\t\t\t\t\t\t\t\t\tcase 'number':\r\n\t\t\t\t\t\t\t\t\tcase 'boolean':\r\n\t\t\t\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\t\t\t\treturn html`<li>${property.key} <em>(${property.type})</em> = ${property.value}</li>`;\r\n\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\treturn html`<li>${property.key} <em>(${property.type})</em></li>`;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</details>\r\n\t\t\t\t`;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'primitive': {\r\n\t\t\t\treturn html`<p>Context is a primitive with value: ${instance.value}</p>`;\r\n\t\t\t}\r\n\r\n\t\t\tdefault: {\r\n\t\t\t\treturn html`<p>Unknown type: ${instance.type}</p>`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport interface UmbExtensionExplorerStateModel {\r\n    hide: boolean\r\n}\r\n\r\nexport default UmbExtensionExplorerContext;"],"names":["UMB_EXTENSION_EXPLORER_CONTEXT","UmbContextToken","UmbExtensionExplorerContext","UmbContextBase","host","__privateAdd","_UmbExtensionExplorerContext_instances","_state","__privateSet","UmbObjectState","__privateGet","filter","state","_a","_c","_b","callback","UmbContextDebugRequest","contexts","contextData","registrationAlias","UmbContextConsumerController","UMB_MODAL_MANAGER_CONTEXT","instance","UMB_CONTEXT_DEBUGGER_MODAL","html","__privateMethod","renderContexts_fn","renderRegistration_fn","map","context","renderContextData_fn","registration","umbExtensionsRegistry","methodName","property"],"mappings":"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"}