{"version":3,"file":"context-BPGWs9n-.js","sources":["../../umbraco.context.explorer.client/src/context.ts"],"sourcesContent":["import {UmbContextBase} from \"@umbraco-cms/backoffice/class-api\";\r\nimport {UmbContextConsumerController, UmbContextDebugRequest, UmbContextToken,\r\n    UmbDebugContextData, UmbDebugContextItemData, contextData} from \"@umbraco-cms/backoffice/context-api\";\r\nimport {UmbControllerHost} from \"@umbraco-cms/backoffice/controller-api\";\r\nimport {filter} from \"@umbraco-cms/backoffice/external/rxjs\";\r\nimport {UmbObjectState} from \"@umbraco-cms/backoffice/observable-api\";\r\nimport {UmbControllerHostElement} from \"@umbraco-cms/backoffice/dist-cms/libs/controller-api\";\r\nimport { UMB_MODAL_MANAGER_CONTEXT, UMB_CONTEXT_DEBUGGER_MODAL, UmbModalManagerContext } from \"@umbraco-cms/backoffice/modal\";\r\nimport { html, map } from \"@umbraco-cms/backoffice/external/lit\";\r\n\r\nexport const UMB_CONTEXT_EXPLORER_CONTEXT = new UmbContextToken<UmbContextExplorerContext>('UmbContextExplorerContext');\r\n\r\nexport class UmbContextExplorerContext extends UmbContextBase<UmbContextExplorerContext> {\r\n    #state = new UmbObjectState<UmbContextExplorerStateModel | undefined>(undefined)\r\n    readonly state = this.#state.asObservable().pipe(filter((state) => !!state));\r\n    readonly hide = this.#state.asObservablePart((state) => state?.hide);\r\n\r\n    constructor(host: UmbControllerHost) {\r\n        super(host, UMB_CONTEXT_EXPLORER_CONTEXT);\r\n        this.#state?.setValue({hide: true})\r\n    }\r\n\r\n    public toggle(){\r\n        this.#state?.setValue({hide: !this.#state?.value?.hide})\r\n    }\r\n    \r\n    getHostContexts(host: UmbControllerHostElement, callback: {(data:UmbDebugContextData[]):void}){\r\n        host.dispatchEvent(\r\n            new UmbContextDebugRequest((contexts: Map<any, any>) => {\r\n                // The Contexts are collected\r\n                // When travelling up through the DOM from this element\r\n                // to the root of <umb-app> which then uses the callback prop\r\n                // of this event that has been raised to assign the contexts\r\n                // back to this property of the WebComponent\r\n\r\n                // Massage the data into a simplier array of objects\r\n                // from a function in the context-api.\r\n                callback(contextData(contexts));\r\n            }),\r\n        );\r\n    }\r\n    \r\n    public displayHostContexts(host: UmbControllerHostElement){\r\n        this.getHostContexts(host,(contexts) =>{\r\n            new UmbContextConsumerController(host, UMB_MODAL_MANAGER_CONTEXT, (instance: UmbModalManagerContext) => {\r\n                console.log(host)\r\n                instance?.open(host, UMB_CONTEXT_DEBUGGER_MODAL, {\r\n                    data:{\r\n                        content: this.#renderContextAliases(contexts)\r\n                    }\r\n                })\r\n            });\r\n        });\r\n    }\r\n\r\n    #renderContextAliases(contexts : UmbDebugContextData[]) {\r\n        return html`<div class=\"events\">\r\n\t\t\t${map(contexts, (context) => {\r\n            return html`\r\n\t\t\t\t\t<details>\r\n\t\t\t\t\t\t<summary><strong>${context.alias}</strong></summary>\r\n\t\t\t\t\t\t${this.#renderInstance(context.data)}\r\n\t\t\t\t\t</details>\r\n\t\t\t\t`;\r\n        })}\r\n\t\t</div>`;\r\n    }\r\n\r\n    #renderInstance(instance: UmbDebugContextItemData) {\r\n        switch (instance.type) {\r\n            case 'function': {\r\n                return html`<h3>Callable Function</h3>`;\r\n            }\r\n\r\n            case 'object': {\r\n                return html`\r\n\t\t\t\t\t<details>\r\n\t\t\t\t\t\t<summary>Methods</summary>\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t${map(instance.methods, (methodName) => html`<li>${methodName}</li>`)}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</details>\r\n\r\n\t\t\t\t\t<details>\r\n\t\t\t\t\t\t<summary>Properties</summary>\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t${map(instance.properties, (property) => {\r\n                    switch (property.type) {\r\n                        case 'string':\r\n                        case 'number':\r\n                        case 'boolean':\r\n                        case 'object':\r\n                            return html`<li>${property.key} <em>(${property.type})</em> = ${property.value}</li>`;\r\n\r\n                        default:\r\n                            return html`<li>${property.key} <em>(${property.type})</em></li>`;\r\n                    }\r\n                })}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</details>\r\n\t\t\t\t`;\r\n            }\r\n\r\n            case 'primitive': {\r\n                return html`<p>Context is a primitive with value: ${instance.value}</p>`;\r\n            }\r\n\r\n            default: {\r\n                return html`<p>Unknown type: ${instance.type}</p>`;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport interface UmbContextExplorerStateModel {\r\n    hide: boolean\r\n}\r\n\r\nexport default UmbContextExplorerContext;"],"names":["UMB_CONTEXT_EXPLORER_CONTEXT","UmbContextToken","UmbContextExplorerContext","UmbContextBase","host","__privateAdd","_UmbContextExplorerContext_instances","_state","__privateSet","UmbObjectState","__privateGet","filter","state","_a","_c","_b","callback","UmbContextDebugRequest","contexts","contextData","UmbContextConsumerController","UMB_MODAL_MANAGER_CONTEXT","instance","UMB_CONTEXT_DEBUGGER_MODAL","__privateMethod","renderContextAliases_fn","html","map","context","renderInstance_fn","methodName","property"],"mappings":";;;;;;;;;;;AAUa,MAAAA,IAA+B,IAAIC,EAA2C,2BAA2B;;AAE/G,MAAMC,UAAkCC,EAA0C;AAAA,EAKrF,YAAYC,GAAyB;;AACjC,UAAMA,GAAMJ,CAA4B;AANzC,IAAAK,EAAA,MAAAC;AACH,IAAAD,EAAA,MAAAE;AAAS,IAAAC,EAAA,MAAAD,GAAA,IAAIE,EAAyD,MAAS,IAC/E,KAAS,QAAQC,EAAA,MAAKH,GAAO,aAAe,EAAA,KAAKI,EAAO,CAACC,MAAU,CAAC,CAACA,CAAK,CAAC,GAC3E,KAAS,OAAOF,EAAA,MAAKH,GAAO,iBAAiB,CAACK,MAAUA,KAAA,gBAAAA,EAAO,IAAI,IAI/DC,IAAAH,EAAA,MAAKH,OAAL,QAAAM,EAAa,SAAS,EAAC,MAAM,GAAK;AAAA,EACtC;AAAA,EAEO,SAAQ;;AACN,KAAAC,IAAAJ,EAAA,MAAAH,OAAA,QAAAO,EAAQ,SAAS,EAAC,MAAM,GAACC,KAAAF,IAAAH,EAAA,MAAKH,OAAL,gBAAAM,EAAa,UAAb,QAAAE,EAAoB,MAAA;AAAA,EACtD;AAAA,EAEA,gBAAgBX,GAAgCY,GAA8C;AACrF,IAAAZ,EAAA;AAAA,MACD,IAAIa,EAAuB,CAACC,MAA4B;AAS3C,QAAAF,EAAAG,EAAYD,CAAQ,CAAC;AAAA,MAAA,CACjC;AAAA,IAAA;AAAA,EAET;AAAA,EAEO,oBAAoBd,GAA+B;AACjD,SAAA,gBAAgBA,GAAK,CAACc,MAAY;AACnC,UAAIE,EAA6BhB,GAAMiB,GAA2B,CAACC,MAAqC;AACpG,gBAAQ,IAAIlB,CAAI,GACNkB,KAAA,QAAAA,EAAA,KAAKlB,GAAMmB,GAA4B;AAAA,UAC7C,MAAK;AAAA,YACD,SAASC,EAAA,MAAKlB,GAAAmB,GAAL,WAA2BP;AAAA,UACxC;AAAA,QAAA;AAAA,MACH,CACJ;AAAA,IAAA,CACJ;AAAA,EACL;AA2DJ;AAnGIX,IAAA,eADGD,IAAA,eA2CHmB,aAAsBP,GAAkC;AAC7C,SAAAQ;AAAA,KACVC,EAAIT,GAAU,CAACU,MACDF;AAAA;AAAA,yBAEME,EAAQ,KAAK;AAAA,QAC9BJ,EAAA,MAAKlB,GAAAuB,GAAL,WAAqBD,EAAQ,KAAK;AAAA;AAAA,KAGjC,CAAC;AAAA;AAEN,GAEAC,aAAgBP,GAAmC;AAC/C,UAAQA,EAAS,MAAM;AAAA,IACnB,KAAK;AACM,aAAAI;AAAA,IAGX,KAAK;AACM,aAAAA;AAAA;AAAA;AAAA;AAAA,SAIdC,EAAIL,EAAS,SAAS,CAACQ,MAAeJ,QAAWI,CAAU,OAAO,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOnEH,EAAIL,EAAS,YAAY,CAACS,MAAa;AAC5B,gBAAQA,EAAS,MAAM;AAAA,UACnB,KAAK;AAAA,UACL,KAAK;AAAA,UACL,KAAK;AAAA,UACL,KAAK;AACM,mBAAAL,QAAWK,EAAS,GAAG,SAASA,EAAS,IAAI,YAAYA,EAAS,KAAK;AAAA,UAElF;AACI,mBAAOL,QAAWK,EAAS,GAAG,SAASA,EAAS,IAAI;AAAA,QAC5D;AAAA,MAAA,CACH,CAAC;AAAA;AAAA;AAAA;AAAA,IAMN,KAAK;AACM,aAAAL,0CAA6CJ,EAAS,KAAK;AAAA,IAGtE;AACW,aAAAI,qBAAwBJ,EAAS,IAAI;AAAA,EAEpD;AACJ;"}